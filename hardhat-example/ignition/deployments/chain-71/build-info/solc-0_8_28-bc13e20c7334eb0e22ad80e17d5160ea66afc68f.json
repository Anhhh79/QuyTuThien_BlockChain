{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-bc13e20c7334eb0e22ad80e17d5160ea66afc68f",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/Charity.sol": "project/contracts/Charity.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/Charity.sol": {
        "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.28;\r\n\r\n/// @title Blockchain Charity Platform – Transparent donation & disbursement\r\n/// @notice Admin tạo chiến dịch, người ủng hộ donate, bình luận, thích và theo dõi sao kê trên blockchain\r\ncontract Charity {\r\n    address public owner;\r\n\r\n    // ---------------- Structures ----------------\r\n    struct Campaign {\r\n        uint256 id;\r\n        address creator;\r\n        string title;\r\n        string description;\r\n        string media;\r\n        string location;\r\n        uint256 targetAmount;\r\n        address payable campaignWallet;\r\n        uint256 collected;\r\n        uint256 createdAt;\r\n        bool active;\r\n    }\r\n\r\n    struct Donation {\r\n        address donor;\r\n        uint256 amount;\r\n        uint256 timestamp;\r\n        uint256 blockNumber;\r\n        bytes32 txHash;\r\n    }\r\n\r\n    struct Disbursement {\r\n        address recipient;\r\n        uint256 amount;\r\n        uint256 timestamp;\r\n        uint256 blockNumber;\r\n        bytes32 txHash;\r\n    }\r\n\r\n    struct Comment {\r\n        address commenter;\r\n        string text;\r\n        uint256 timestamp;\r\n        bool isAnonymous;\r\n    }\r\n\r\n    // -------------- State variables ----------------\r\n    uint256 public nextCampaignId = 1;\r\n    mapping(uint256 => Campaign) public campaigns;\r\n    mapping(uint256 => Donation[]) private donations;\r\n    mapping(uint256 => Disbursement[]) private disbursements;\r\n    mapping(uint256 => Comment[]) private comments;\r\n\r\n    mapping(uint256 => address[]) private supportersList;\r\n    mapping(uint256 => mapping(address => bool)) private hasSupported;\r\n\r\n    mapping(uint256 => mapping(address => bool)) public liked;\r\n    mapping(uint256 => uint256) public likesCount;\r\n\r\n    mapping(address => bool) public isAdmin;\r\n\r\n    // -------------- Events ----------------\r\n    event CampaignCreated(uint256 indexed id, address indexed creator);\r\n    event DonationReceived(uint256 indexed campaignId, address indexed donor, uint256 amount, bytes32 txHash);\r\n    event Disbursed(uint256 indexed campaignId, address indexed recipient, uint256 amount, bytes32 txHash);\r\n    event CommentAdded(uint256 indexed campaignId, address indexed commenter, string text);\r\n    event Liked(uint256 indexed campaignId, address indexed liker);\r\n    event Unliked(uint256 indexed campaignId, address indexed liker);\r\n\r\n    // -------------- Modifiers ----------------\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner, \"only owner\");\r\n        _;\r\n    }\r\n\r\n    modifier onlyAdmin() {\r\n        require(isAdmin[msg.sender], \"only admin\");\r\n        _;\r\n    }\r\n\r\n    constructor() {\r\n        owner = msg.sender;\r\n        isAdmin[msg.sender] = true;\r\n    }\r\n\r\n    // -------------- Admin ----------------\r\n    function setAdmin(address account, bool allowed) external onlyOwner {\r\n        isAdmin[account] = allowed;\r\n    }\r\n\r\n    function createCampaign(\r\n        string calldata title,\r\n        string calldata description,\r\n        string calldata media,\r\n        string calldata location,\r\n        uint256 targetAmount,\r\n        address payable campaignWallet\r\n    ) external onlyAdmin returns (uint256) {\r\n        uint256 id = nextCampaignId++;\r\n        campaigns[id] = Campaign({\r\n            id: id,\r\n            creator: msg.sender,\r\n            title: title,\r\n            description: description,\r\n            media: media,\r\n            location: location,\r\n            targetAmount: targetAmount,\r\n            campaignWallet: campaignWallet,\r\n            collected: 0,\r\n            createdAt: block.timestamp,\r\n            active: true\r\n        });\r\n\r\n        emit CampaignCreated(id, msg.sender);\r\n        return id;\r\n    }\r\n\r\n    // -------------- Donate ----------------\r\n    function donate(uint256 campaignId) external payable {\r\n        require(msg.value > 0, \"donation must be > 0\");\r\n        Campaign storage c = campaigns[campaignId];\r\n        require(c.id != 0, \"campaign not found\");\r\n        require(c.active, \"campaign not active\");\r\n\r\n        c.collected += msg.value;\r\n\r\n        bytes32 txHash = keccak256(abi.encodePacked(block.number, msg.sender, msg.value, block.timestamp));\r\n\r\n        donations[campaignId].push(Donation({\r\n            donor: msg.sender,\r\n            amount: msg.value,\r\n            timestamp: block.timestamp,\r\n            blockNumber: block.number,\r\n            txHash: txHash\r\n        }));\r\n\r\n        if (!hasSupported[campaignId][msg.sender]) {\r\n            hasSupported[campaignId][msg.sender] = true;\r\n            supportersList[campaignId].push(msg.sender);\r\n        }\r\n\r\n        if (c.campaignWallet != address(0)) {\r\n            (bool ok, ) = c.campaignWallet.call{value: msg.value}(\"\");\r\n            require(ok, \"forward failed\");\r\n        }\r\n\r\n        emit DonationReceived(campaignId, msg.sender, msg.value, txHash);\r\n    }\r\n\r\n    // -------------- Disbursement ----------------\r\n    function disburseFromContract(uint256 campaignId, address payable recipient, uint256 amount)\r\n        external onlyAdmin\r\n    {\r\n        Campaign storage c = campaigns[campaignId];\r\n        require(c.id != 0, \"campaign not found\");\r\n        require(amount > 0, \"amount must be > 0\");\r\n        require(address(this).balance >= amount, \"insufficient balance\");\r\n\r\n        bytes32 txHash = keccak256(abi.encodePacked(block.number, recipient, amount, block.timestamp));\r\n\r\n        (bool ok, ) = recipient.call{value: amount}(\"\");\r\n        require(ok, \"transfer failed\");\r\n\r\n        disbursements[campaignId].push(Disbursement({\r\n            recipient: recipient,\r\n            amount: amount,\r\n            timestamp: block.timestamp,\r\n            blockNumber: block.number,\r\n            txHash: txHash\r\n        }));\r\n\r\n        emit Disbursed(campaignId, recipient, amount, txHash);\r\n    }\r\n\r\n    function setCampaignActive(uint256 campaignId, bool active) external onlyAdmin {\r\n        campaigns[campaignId].active = active;\r\n    }\r\n\r\n    // -------------- Comments ----------------\r\n    function addComment(uint256 campaignId, string calldata text, bool anon) external {\r\n        require(campaigns[campaignId].id != 0, \"campaign not found\");\r\n\r\n        comments[campaignId].push(Comment({\r\n            commenter: msg.sender,\r\n            text: text,\r\n            timestamp: block.timestamp,\r\n            isAnonymous: anon\r\n        }));\r\n\r\n        emit CommentAdded(campaignId, msg.sender, text);\r\n    }\r\n\r\n    // -------------- Likes ----------------\r\n    function like(uint256 campaignId) external {\r\n        require(campaigns[campaignId].id != 0, \"campaign not found\");\r\n        require(!liked[campaignId][msg.sender], \"already liked\");\r\n\r\n        liked[campaignId][msg.sender] = true;\r\n        likesCount[campaignId]++;\r\n\r\n        emit Liked(campaignId, msg.sender);\r\n    }\r\n\r\n    function unlike(uint256 campaignId) external {\r\n        require(liked[campaignId][msg.sender], \"not liked\");\r\n\r\n        liked[campaignId][msg.sender] = false;\r\n        likesCount[campaignId]--;\r\n\r\n        emit Unliked(campaignId, msg.sender);\r\n    }\r\n\r\n    // -------------- View Functions (Frontend Friendly) ----------------\r\n    function getSupporters(uint256 id) external view returns (address[] memory) {\r\n        return supportersList[id];\r\n    }\r\n\r\n    function getSupportersCount(uint256 id) external view returns (uint256) {\r\n        return supportersList[id].length;\r\n    }\r\n\r\n    function getDonationsCount(uint256 id) external view returns (uint256) {\r\n        return donations[id].length;\r\n    }\r\n\r\n    function getDonation(uint256 id, uint256 index) external view returns (Donation memory) {\r\n        return donations[id][index];\r\n    }\r\n\r\n    function getDisbursementsCount(uint256 id) external view returns (uint256) {\r\n        return disbursements[id].length;\r\n    }\r\n\r\n    function getDisbursement(uint256 id, uint256 index) external view returns (Disbursement memory) {\r\n        return disbursements[id][index];\r\n    }\r\n\r\n    function getCommentsCount(uint256 id) external view returns (uint256) {\r\n        return comments[id].length;\r\n    }\r\n\r\n    function getComment(uint256 id, uint256 index) external view returns (Comment memory) {\r\n        return comments[id][index];\r\n    }\r\n\r\n    // -------------- Receive Donation without specifying campaign ----------------\r\n    receive() external payable {}\r\n    fallback() external payable {}\r\n}\r\n"
      }
    }
  }
}